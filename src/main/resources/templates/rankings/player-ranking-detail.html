<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
    <title th:text="${pageTitle}">Chi tiết VĐV - BTMS</title>
    <link rel="stylesheet" th:href="@{/css/rankings/rankings.css}">
</head>
<body>
<div layout:fragment="content">
    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
                    <li class="breadcrumb-item"><a href="/rankings">Xếp hạng</a></li>
                    <li class="breadcrumb-item active" th:text="${player.name}">VĐV</li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Player Profile -->
    <section class="player-profile-section section-padding">
        <div class="container">
            <div class="row">
                <!-- Player Info -->
                <div class="col-lg-4">
                    <div class="player-card" data-aos="fade-right">
                        <div class="player-avatar-large">
                            <img th:src="${player.avatar}" th:alt="${player.name}"
                                 onerror="this.src='/images/players/default-avatar.png'">
                            <div class="rank-badge-large" th:classappend="${player.rank <= 3} ? 'top-' + ${player.rank}">
                                <span th:text="${player.rank}">1</span>
                            </div>
                        </div>
                        <h2 class="player-name" th:text="${player.name}">Nguyễn Tiến Minh</h2>
                        <div class="player-points">
                            <span th:text="${#numbers.formatInteger(player.points, 0, 'COMMA')}">52,340</span> điểm
                        </div>
                        <div class="player-info-list">
                            <div class="info-item">
                                <span class="label">Quốc gia:</span>
                                <span class="value" th:text="${player.country}">Việt Nam</span>
                            </div>
                            <div class="info-item">
                                <span class="label">CLB:</span>
                                <span class="value" th:text="${player.club}">CLB TP.HCM</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Năm sinh:</span>
                                <span class="value" th:text="${player.birthYear}">1983</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Chiều cao:</span>
                                <span class="value" th:text="${player.height}">1m76</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Tay thuận:</span>
                                <span class="value" th:text="${player.playStyle}">Tay phải</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Chuyên nghiệp:</span>
                                <span class="value" th:text="${player.turnedPro}">2000</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats & History -->
                <div class="col-lg-8">
                    <!-- Quick Stats -->
                    <div class="stats-grid" data-aos="fade-up">
                        <div class="stat-card">
                            <i class="bi bi-trophy"></i>
                            <div class="stat-content">
                                <span class="stat-value" th:text="${player.titlesWon}">24</span>
                                <span class="stat-label">Danh hiệu</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="bi bi-percent"></i>
                            <div class="stat-content">
                                <span class="stat-value" th:text="${player.winRate + '%'}">78.5%</span>
                                <span class="stat-label">Tỉ lệ thắng</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="bi bi-star"></i>
                            <div class="stat-content">
                                <span class="stat-value" th:text="${player.highestRank}">1</span>
                                <span class="stat-label">Hạng cao nhất</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bio -->
                    <div class="player-bio" data-aos="fade-up" data-aos-delay="100">
                        <h3><i class="bi bi-person-lines-fill"></i> Tiểu sử</h3>
                        <p th:text="${player.bio}">Tiểu sử VĐV...</p>
                    </div>

                    <!-- Rank History Chart -->
                    <div class="rank-history" data-aos="fade-up" data-aos-delay="200">
                        <h3><i class="bi bi-graph-up"></i> Lịch sử xếp hạng</h3>
                        <div class="history-chart">
                            <canvas id="rankHistoryChart"></canvas>
                        </div>
                        <div class="history-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tháng</th>
                                        <th>Hạng</th>
                                        <th>Điểm</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="h : ${rankHistory}">
                                        <td th:text="${h.month}">12/2025</td>
                                        <td th:text="${h.rank}">1</td>
                                        <td th:text="${#numbers.formatInteger(h.points, 0, 'COMMA')}">52,000</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recent Matches -->
                    <div class="recent-matches" data-aos="fade-up" data-aos-delay="300">
                        <h3><i class="bi bi-list-check"></i> Trận đấu gần đây</h3>
                        <div class="matches-list">
                            <th:block th:each="match : ${recentMatches}">
                                <div class="match-item">
                                    <div class="match-info">
                                        <span class="match-date" th:text="${match.date}">28/11/2025</span>
                                        <span class="match-tournament" th:text="${match.tournament}">BTMS Cup 2025</span>
                                    </div>
                                    <div class="match-result">
                                        <span class="opponent">vs <span th:text="${match.opponent}">Lê Đức Phát</span></span>
                                        <span class="result" th:classappend="${match.result == 'W'} ? 'win' : 'loss'"
                                              th:text="${match.result == 'W'} ? 'Thắng' : 'Thua'">Thắng</span>
                                        <span class="score" th:text="${match.score}">21-18, 21-15</span>
                                    </div>
                                </div>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<th:block layout:fragment="scripts">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/rankings/rankings.js"></script>
    <script th:inline="javascript">
        // Rank History Chart
        const rankHistory = /*[[${rankHistory}]]*/ [];
        if (rankHistory.length > 0) {
            const ctx = document.getElementById('rankHistoryChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: rankHistory.map(h => h.month).reverse(),
                        datasets: [{
                            label: 'Xếp hạng',
                            data: rankHistory.map(h => h.rank).reverse(),
                            borderColor: '#00d4aa',
                            backgroundColor: 'rgba(0, 212, 170, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                reverse: true,
                                min: 1
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
        }
    </script>
</th:block>
</body>
</html>
