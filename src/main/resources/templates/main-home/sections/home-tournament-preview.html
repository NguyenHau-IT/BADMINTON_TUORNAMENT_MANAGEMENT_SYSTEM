<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- Tournament Preview Section - Carousel Style for Fullpage -->
    <section th:fragment="tournament-preview" class="tournament-preview-section">
        <div class="container h-100 d-flex flex-column justify-content-center">
            <!-- Section Header - Compact -->
            <div class="row mb-3">
                <div class="col-lg-8 mx-auto text-center">
                    <span class="section-badge" data-aos="fade-up">
                        <i class="bi bi-trophy me-2"></i>Giải đấu nổi bật
                    </span>
                    <h2 class="section-title text-white mt-2 mb-2" data-aos="fade-up" data-aos-delay="100">
                        Tham gia <span class="text-accent">giải đấu</span> ngay
                    </h2>
                </div>
            </div>
            
            <!-- Tournament Carousel -->
            <div class="tournament-carousel-wrapper" data-aos="fade-up" data-aos-delay="200">
                <div class="tournament-carousel" id="tournamentCarousel">
                    <!-- Carousel Track -->
                    <div class="carousel-track">
                        <!-- Dynamic Tournament Cards -->
                        <div class="carousel-slide" 
                             th:each="tournament, iterStat : ${featuredTournaments}"
                             th:classappend="${iterStat.index == 0} ? 'active' : ''">
                            
                            <div class="featured-tournament-card">
                                <!-- Left: Image -->
                                <div class="tournament-image-side">
                                    <img th:src="${tournament.hinhAnh}" 
                                         th:alt="${tournament.tenGiai}"
                                         loading="lazy"
                                         th:onerror="'this.src=\'/icons/tournaments/default.jpg\''">
                                    
                                    <!-- Status Badge -->
                                    <div th:if="${tournament.trangThai == 'ongoing'}" class="status-badge badge-live">
                                        <i class="bi bi-broadcast"></i> LIVE
                                    </div>
                                    <div th:if="${tournament.trangThai == 'upcoming'}" class="status-badge badge-upcoming">
                                        <i class="bi bi-clock"></i> Sắp diễn ra
                                    </div>
                                    <div th:if="${tournament.trangThai == 'registration'}" class="status-badge badge-registration">
                                        <i class="bi bi-pencil-square"></i> Đang nhận đăng ký
                                    </div>
                                    <div th:if="${tournament.trangThai == 'completed'}" class="status-badge badge-completed">
                                        <i class="bi bi-check-circle"></i> Đã kết thúc
                                    </div>
                                </div>
                                
                                <!-- Right: Content -->
                                <div class="tournament-info-side">
                                    <div class="tournament-meta">
                                        <span class="meta-badge">
                                            <i class="bi bi-calendar3"></i>
                                            <span th:text="${tournament.ngayBatDau}">Ngày</span>
                                        </span>
                                        <span class="meta-badge">
                                            <i class="bi bi-geo-alt"></i>
                                            <span th:text="${tournament.tinhThanh}">Địa điểm</span>
                                        </span>
                                    </div>
                                    
                                    <h3 class="tournament-name" th:text="${tournament.tenGiai}">
                                        Tên giải đấu
                                    </h3>
                                    
                                    <div class="tournament-highlights">
                                        <div class="highlight-item">
                                            <i class="bi bi-trophy-fill"></i>
                                            <div class="highlight-info">
                                                <span class="highlight-label">Cấp độ</span>
                                                <span class="highlight-value" th:text="${tournament.capDo} ?: 'Phong trào'">Hạng</span>
                                            </div>
                                        </div>
                                        <div class="highlight-item">
                                            <i class="bi bi-star-fill"></i>
                                            <div class="highlight-info">
                                                <span class="highlight-label">Đánh giá</span>
                                                <span class="highlight-value" th:text="${tournament.danhGiaTb} ?: '4.5'">Rating</span>
                                            </div>
                                        </div>
                                        <div class="highlight-item">
                                            <i class="bi bi-cash-stack"></i>
                                            <div class="highlight-info">
                                                <span class="highlight-label">Phí</span>
                                                <span class="highlight-value" th:text="${tournament.phiThamGiaText} ?: 'Miễn phí'">Giải thưởng</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="tournament-actions">
                                        <a th:href="@{/tournament/detail/{id}(id=${tournament.id})}" 
                                           class="btn-tournament-primary">
                                            <span>Xem chi tiết</span>
                                            <i class="bi bi-arrow-right"></i>
                                        </a>
                                        <a th:if="${tournament.trangThai == 'registration'}" 
                                           th:href="@{/tournament/register/{id}(id=${tournament.id})}" 
                                           class="btn-tournament-accent">
                                            <span>Đăng ký ngay</span>
                                            <i class="bi bi-pencil-square"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Fallback if no tournaments -->
                        <div class="carousel-slide active" th:if="${#lists.isEmpty(featuredTournaments)}">
                            <div class="featured-tournament-card empty-state">
                                <div class="empty-content">
                                    <i class="bi bi-trophy"></i>
                                    <h3>Chưa có giải đấu nổi bật</h3>
                                    <p>Các giải đấu mới sẽ được cập nhật sớm</p>
                                    <a th:href="@{/tournament/list}" class="btn-tournament-primary">
                                        <span>Xem tất cả giải đấu</span>
                                        <i class="bi bi-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Carousel Navigation -->
                    <button class="carousel-nav carousel-prev" onclick="prevTournament()" aria-label="Previous">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <button class="carousel-nav carousel-next" onclick="nextTournament()" aria-label="Next">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                
                <!-- Carousel Dots -->
                <div class="carousel-dots" id="carouselDots">
                    <span th:each="tournament, iterStat : ${featuredTournaments}" 
                          class="dot"
                          th:classappend="${iterStat.index == 0} ? 'active' : ''"
                          th:onclick="'goToSlide(' + ${iterStat.index} + ')'"></span>
                </div>
            </div>
            
            <!-- View All Link -->
            <div class="text-center mt-3" data-aos="fade-up" data-aos-delay="300">
                <a th:href="@{/tournament/list}" class="view-all-link">
                    Xem tất cả giải đấu <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <!-- Carousel Script -->
        <script>
            let currentSlide = 0;
            const slides = document.querySelectorAll('.carousel-slide');
            const dots = document.querySelectorAll('.carousel-dots .dot');
            const totalSlides = slides.length;
            
            function showSlide(index) {
                if (totalSlides === 0) return;
                
                currentSlide = (index + totalSlides) % totalSlides;
                
                slides.forEach((slide, i) => {
                    slide.classList.toggle('active', i === currentSlide);
                });
                
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === currentSlide);
                });
            }
            
            function nextTournament() {
                showSlide(currentSlide + 1);
            }
            
            function prevTournament() {
                showSlide(currentSlide - 1);
            }
            
            function goToSlide(index) {
                showSlide(index);
            }
            
            // Auto-advance every 5 seconds
            setInterval(() => {
                if (document.visibilityState === 'visible') {
                    nextTournament();
                }
            }, 5000);
        </script>
    </section>
</body>
</html>
