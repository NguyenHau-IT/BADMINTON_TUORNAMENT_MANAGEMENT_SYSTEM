<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/base}">

<head>
    <title th:text="${pageTitle}">Tải xuống BTMS</title>
    <meta name="description" th:content="${pageDescription}">

    <!-- Page-specific CSS -->
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/pages/app-hub.css}">
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    </th:block>
</head>

<body>
    <div layout:fragment="content">
        <!-- Hero Section -->
        <section class="download-hero bg-gradient-primary text-white py-5">
            <div class="container">
                <div class="text-center" data-aos="fade-down">
                    <i class="fas fa-download fa-4x mb-4"></i>
                    <h1 class="display-4 fw-bold mb-3">Tải xuống BTMS</h1>
                    <p class="lead mb-4">Miễn phí · An toàn · Không quảng cáo</p>

                    <!-- OS Detection Alert -->
                    <div class="alert alert-light d-inline-block" th:if="${detectedOS != 'unknown'}">
                        <i class="fas fa-info-circle me-2"></i>
                        <span>Hệ điều hành của bạn:
                            <strong
                                th:text="${detectedOS == 'windows' ? 'Windows' : (detectedOS == 'macos' ? 'macOS' : detectedOS == 'linux' ? 'Linux' : detectedOS)}">Windows</strong>
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Download Options -->
        <section class="download-options py-5">
            <div class="container">
                <div class="row justify-content-center mb-5">
                    <div class="col-lg-10">
                        <div class="card border-0 shadow-lg mb-4" data-aos="zoom-in">
                            <div class="card-body p-5">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h3 class="fw-bold mb-3">
                                            <i class="fas fa-windows me-2"></i>
                                            Windows Installer (Khuyến nghị)
                                        </h3>
                                        <p class="text-muted mb-3">
                                            File cài đặt hoàn chỉnh bao gồm Java Runtime. Chỉ cần tải về và chạy.
                                        </p>
                                        <div class="download-meta d-flex flex-wrap gap-3 mb-3">
                                            <span class="badge bg-primary">
                                                <i class="fas fa-desktop"></i> Windows 10/11 64-bit
                                            </span>
                                            <span class="badge bg-info">
                                                <i class="fas fa-file-archive"></i> 144 MB
                                            </span>
                                            <span class="badge bg-success">
                                                <i class="fas fa-check-circle"></i> Bao gồm Java Runtime
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-md-end text-center">
                                        <a href="/downloads/Badminton Tournament Management System (BTMS)-1.0.0.msi"
                                            class="btn btn-primary btn-lg shadow" download>
                                            <i class="fas fa-download"></i> Tải xuống
                                        </a>
                                        <p class="text-muted small mt-2 mb-0">Phiên bản 1.0.0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alternative Download Options -->
                <div class="row">
                    <div class="col-lg-6 mb-4" th:each="option, iterStat : ${downloadOptions}"
                        th:if="${iterStat.index > 0}" data-aos="fade-up"
                        th:attr="data-aos-delay=${iterStat.index * 100}">
                        <div class="card h-100 border-0 shadow-sm hover-lift">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-start mb-3">
                                    <i class="fas fa-3x me-3 mt-1" th:classappend="${option.icon}"
                                        th:class="${option.platform == 'windows-portable' ? 'text-info' : 'text-warning'}"></i>
                                    <div>
                                        <h5 class="card-title fw-bold mb-2" th:text="${option.name}">Download Option
                                        </h5>
                                        <p class="text-muted mb-0" th:text="${option.notes}">Notes</p>
                                    </div>
                                </div>
                                <div class="download-info mb-3">
                                    <p class="mb-2">
                                        <i class="fas fa-file me-2 text-muted"></i>
                                        <strong>File:</strong> <code th:text="${option.filename}">filename.zip</code>
                                    </p>
                                    <p class="mb-0">
                                        <i class="fas fa-hdd me-2 text-muted"></i>
                                        <strong>Dung lượng:</strong> <span th:text="${option.size}">150 MB</span>
                                    </p>
                                </div>
                                <a th:href="${option.link}" class="btn btn-outline-primary w-100" download>
                                    <i class="fas fa-download"></i> Tải xuống
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Installation Guide -->
        <section class="installation-guide py-5 bg-light">
            <div class="container">
                <div class="text-center mb-5" data-aos="fade-up">
                    <h2 class="section-title fw-bold">Hướng dẫn Cài đặt</h2>
                    <p class="text-muted">4 bước đơn giản để bắt đầu sử dụng BTMS</p>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="installation-steps">
                            <div class="step-item card border-0 shadow-sm mb-4" th:each="step : ${installSteps}"
                                data-aos="fade-right" th:attr="data-aos-delay=${step.step * 100}">
                                <div class="card-body p-4">
                                    <div class="d-flex align-items-start">
                                        <div class="step-number">
                                            <div class="number-circle bg-primary text-white fw-bold">
                                                <span th:text="${step.step}">1</span>
                                            </div>
                                        </div>
                                        <div class="step-content flex-grow-1">
                                            <h5 class="fw-bold mb-2" th:text="${step.title}">Step Title</h5>
                                            <p class="text-muted mb-0" th:text="${step.description}">Step description
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- System Requirements -->
        <section class="system-requirements-section py-5">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6 mb-4 mb-lg-0" data-aos="fade-right">
                        <h2 class="section-title fw-bold mb-4">Yêu cầu Hệ thống</h2>
                        <p class="text-muted mb-4">
                            Đảm bảo máy tính của bạn đáp ứng các yêu cầu sau để chạy BTMS mượt mà.
                        </p>

                        <div class="requirements-table">
                            <div
                                class="requirement-row d-flex justify-content-between align-items-center py-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-desktop fa-lg text-primary me-3"></i>
                                    <strong>Hệ điều hành</strong>
                                </div>
                                <span class="text-muted">Windows 10/11 64-bit</span>
                            </div>
                            <div
                                class="requirement-row d-flex justify-content-between align-items-center py-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-microchip fa-lg text-primary me-3"></i>
                                    <strong>Bộ xử lý</strong>
                                </div>
                                <span class="text-muted">Intel Core i3+</span>
                            </div>
                            <div
                                class="requirement-row d-flex justify-content-between align-items-center py-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-memory fa-lg text-primary me-3"></i>
                                    <strong>RAM</strong>
                                </div>
                                <span class="text-muted">4 GB (khuyến nghị 8 GB)</span>
                            </div>
                            <div
                                class="requirement-row d-flex justify-content-between align-items-center py-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-hdd fa-lg text-primary me-3"></i>
                                    <strong>Dung lượng</strong>
                                </div>
                                <span class="text-muted">500 MB khả dụng</span>
                            </div>
                            <div class="requirement-row d-flex justify-content-between align-items-center py-3">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-tv fa-lg text-primary me-3"></i>
                                    <strong>Màn hình</strong>
                                </div>
                                <span class="text-muted">1280x720+</span>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6" data-aos="fade-left" data-aos-delay="200">
                        <div class="card border-0 shadow-lg bg-primary text-white">
                            <div class="card-body p-5">
                                <h4 class="fw-bold mb-4">
                                    <i class="fas fa-lightbulb me-2"></i> Lưu ý quan trọng
                                </h4>
                                <ul class="list-unstyled mb-0">
                                    <li class="mb-3 d-flex align-items-start">
                                        <i class="fas fa-check-circle me-3 mt-1"></i>
                                        <span>Java Runtime được cài đặt tự động cùng ứng dụng</span>
                                    </li>
                                    <li class="mb-3 d-flex align-items-start">
                                        <i class="fas fa-check-circle me-3 mt-1"></i>
                                        <span>Không cần SQL Server riêng (sử dụng H2 embedded)</span>
                                    </li>
                                    <li class="mb-3 d-flex align-items-start">
                                        <i class="fas fa-check-circle me-3 mt-1"></i>
                                        <span>Tương thích hoàn toàn với Windows Defender</span>
                                    </li>
                                    <li class="mb-3 d-flex align-items-start">
                                        <i class="fas fa-check-circle me-3 mt-1"></i>
                                        <span>Hỗ trợ nhiều màn hình (multi-monitor setup)</span>
                                    </li>
                                    <li class="d-flex align-items-start">
                                        <i class="fas fa-check-circle me-3 mt-1"></i>
                                        <span>Không cần kết nối internet để sử dụng</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Checksums & Verification -->
        <section class="verification-section py-5 bg-light">
            <div class="container">
                <div class="text-center mb-5" data-aos="fade-up">
                    <h2 class="section-title fw-bold">Xác thực File Tải xuống</h2>
                    <p class="text-muted">Kiểm tra tính toàn vẹn của file bằng SHA256 checksum</p>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="card border-0 shadow" data-aos="fade-up">
                            <div class="card-body p-4">
                                <div class="checksums-list">
                                    <div class="checksum-item mb-4" th:each="entry : ${checksums}">
                                        <h6 class="fw-bold text-primary mb-2"
                                            th:text="${entry.key == 'windows-exe' ? 'Windows Installer (.exe)' : (entry.key == 'portable-zip' ? 'Portable Version (.zip)' : 'JAR File')}">
                                            File Type
                                        </h6>
                                        <div class="input-group">
                                            <input type="text" class="form-control font-monospace text-muted"
                                                th:value="${entry.value}" readonly>
                                            <button class="btn btn-outline-secondary" type="button"
                                                onclick="copyToClipboard(this)">
                                                <i class="fas fa-copy"></i> Copy
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-info mb-0">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Cách kiểm tra:</strong> Mở PowerShell và chạy:
                                    <code>Get-FileHash btms-windows-x64.exe -Algorithm SHA256</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Version History -->
        <section class="version-history py-5">
            <div class="container">
                <div class="text-center mb-5" data-aos="fade-up">
                    <h2 class="section-title fw-bold">Lịch sử Phiên bản</h2>
                    <p class="text-muted">Các phiên bản gần đây của BTMS</p>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="versions-list">
                            <div class="version-item card border-0 shadow-sm mb-3" th:each="version : ${versionHistory}"
                                data-aos="fade-up">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="fw-bold mb-1">
                                                <i class="fas fa-tag text-primary me-2"></i>
                                                Version <span th:text="${version.version}">1.0.0</span>
                                            </h5>
                                            <p class="text-muted mb-0">
                                                <i class="fas fa-calendar me-2"></i>
                                                Phát hành: <span th:text="${version.date}">25/11/2025</span>
                                            </p>
                                        </div>
                                        <span class="badge"
                                            th:classappend="${version.status == 'Latest' ? 'bg-success' : 'bg-secondary'}"
                                            th:text="${version.status}">
                                            Latest
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Help Section -->
        <section class="help-section py-5 bg-light">
            <div class="container text-center">
                <div data-aos="zoom-in">
                    <h3 class="fw-bold mb-3">Cần giúp đỡ?</h3>
                    <p class="text-muted mb-4">
                        Gặp vấn đề khi tải xuống hoặc cài đặt? Chúng tôi sẵn sàng hỗ trợ!
                    </p>
                    <div class="d-flex flex-wrap justify-content-center gap-3">
                        <a th:href="@{/app/learn-more/manual}" class="btn btn-primary">
                            <i class="fas fa-book"></i> Xem Hướng dẫn
                        </a>
                        <a th:href="@{/app/learn-more}" class="btn btn-outline-primary">
                            <i class="fas fa-question-circle"></i> FAQ
                        </a>
                        <a href="mailto:support@btms.com" class="btn btn-outline-secondary">
                            <i class="fas fa-envelope"></i> Liên hệ Hỗ trợ
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Page-specific JS -->
    <th:block layout:fragment="scripts">
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script>
            // Initialize AOS
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true,
                offset: 100
            });

            // Copy to clipboard function
            function copyToClipboard(button) {
                const input = button.previousElementSibling;
                input.select();
                document.execCommand('copy');

                // Visual feedback
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                button.classList.remove('btn-outline-secondary');
                button.classList.add('btn-success');

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('btn-success');
                    button.classList.add('btn-outline-secondary');
                }, 2000);
            }

            // Download tracking (optional - can integrate with analytics)
            document.querySelectorAll('a[download]').forEach(link => {
                link.addEventListener('click', function (e) {
                    console.log('Download started:', this.href);
                    // Google Analytics tracking example:
                    // gtag('event', 'download', { 'file_name': this.getAttribute('href') });
                });
            });
        </script>
    </th:block>
</body>

</html>